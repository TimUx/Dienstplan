<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dienstplan - Schichtverwaltung</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="/images/fw-logo-white.svg" alt="Fritz Winter Logo" class="company-logo-img">
                    <div class="divider"></div>
                    <h1>Dienstplan - Schichtverwaltung</h1>
                </div>
                <div class="header-right">
                    <nav>
                        <button onclick="showView('schedule')" class="nav-btn active">Dienstplan</button>
                        <button onclick="showView('employees')" class="nav-btn">Mitarbeiter</button>
                        <button onclick="showView('teams')" class="nav-btn">Teams</button>
                        <button onclick="showView('vacations')" class="nav-btn" id="nav-vacations" style="display:none;">Urlaub</button>
                        <button onclick="showView('statistics')" class="nav-btn">Statistiken</button>
                        <button onclick="showView('manual')" class="nav-btn">üìñ Hilfe</button>
                        <button onclick="showView('admin')" class="nav-btn admin-only" id="nav-admin" style="display:none;">‚öôÔ∏è Admin</button>
                    </nav>
                    <div id="user-info" class="user-info" style="display: none;">
                        <span id="user-name"></span>
                        <button onclick="logout()" class="btn-logout">Abmelden</button>
                    </div>
                    <div id="login-prompt" class="login-prompt">
                        <button onclick="showLoginModal()" class="btn-login">Anmelden</button>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <!-- Schedule View -->
            <div id="schedule-view" class="view active">
                <div class="controls">
                    <div class="date-controls">
                        <button onclick="changeDate(-1)">‚óÄ Vorherige Woche</button>
                        <input type="date" id="startDate" onchange="loadSchedule()">
                        <button onclick="changeDate(1)">N√§chste Woche ‚ñ∂</button>
                    </div>
                    <div class="view-controls">
                        <select id="viewType" onchange="loadSchedule()">
                            <option value="week">Woche</option>
                            <option value="month">Monat</option>
                            <option value="year">Jahr</option>
                        </select>
                        <button onclick="planShifts()" class="btn-primary admin-only">Schichten planen</button>
                        <button onclick="exportScheduleToPdf()" class="btn-secondary">üìÑ PDF Export</button>
                    </div>
                </div>
                
                <div id="schedule-content" class="schedule-grid">
                    <p class="loading">Lade Dienstplan...</p>
                </div>
            </div>

            <!-- Employees View -->
            <div id="employees-view" class="view">
                <div class="controls">
                    <button onclick="showAddEmployeeModal()" class="btn-primary">+ Mitarbeiter hinzuf√ºgen</button>
                </div>
                <div id="employees-content">
                    <p class="loading">Lade Mitarbeiter...</p>
                </div>
            </div>

            <!-- Statistics View -->
            <div id="statistics-view" class="view">
                <div class="controls">
                    <div class="date-range">
                        <label>Von: <input type="date" id="statsStartDate"></label>
                        <label>Bis: <input type="date" id="statsEndDate"></label>
                        <button onclick="loadStatistics()" class="btn-primary">Aktualisieren</button>
                    </div>
                </div>
                <div id="statistics-content">
                    <p class="loading">Lade Statistiken...</p>
                </div>
            </div>

            <!-- Teams View -->
            <div id="teams-view" class="view">
                <div class="controls">
                    <button onclick="showAddTeamModal()" class="btn-primary admin-only">+ Team hinzuf√ºgen</button>
                </div>
                <div id="teams-content">
                    <p class="loading">Lade Teams...</p>
                </div>
            </div>

            <!-- Vacations View -->
            <div id="vacations-view" class="view">
                <h2>Urlaubsverwaltung</h2>
                <div class="tabs">
                    <button onclick="showVacationTab('requests')" class="tab-btn active" id="tab-requests">Urlaubsantr√§ge</button>
                    <button onclick="showVacationTab('exchanges')" class="tab-btn" id="tab-exchanges">Diensttausch</button>
                </div>
                
                <div id="vacation-requests-tab" class="tab-content active">
                    <div class="controls">
                        <button onclick="showAddVacationRequestModal()" class="btn-primary">+ Urlaubsantrag stellen</button>
                        <button onclick="loadVacationRequests('pending')" class="btn-secondary admin-only">Offene Antr√§ge</button>
                        <button onclick="loadVacationRequests('all')" class="btn-secondary admin-only">Alle Antr√§ge</button>
                    </div>
                    <div id="vacation-requests-content">
                        <p class="loading">Lade Urlaubsantr√§ge...</p>
                    </div>
                </div>

                <div id="shift-exchanges-tab" class="tab-content">
                    <div class="controls">
                        <button onclick="showOfferShiftExchangeModal()" class="btn-primary">+ Dienst anbieten</button>
                        <button onclick="loadShiftExchanges('available')" class="btn-secondary">Verf√ºgbare Tausche</button>
                        <button onclick="loadShiftExchanges('pending')" class="btn-secondary admin-only">Offene Anfragen</button>
                    </div>
                    <div id="shift-exchanges-content">
                        <p class="loading">Lade Diensttausch-Angebote...</p>
                    </div>
                </div>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="view">
                <h2>‚öôÔ∏è Administration</h2>
                <div class="admin-sections">
                    <div class="admin-section">
                        <h3>üë• Benutzerverwaltung</h3>
                        <p>Verwaltung von Benutzerkonten, Passw√∂rtern und Rollen.</p>
                        <div class="controls">
                            <button onclick="showAddUserModal()" class="btn-primary">+ Benutzer hinzuf√ºgen</button>
                        </div>
                        <div id="users-content">
                            <p class="loading">Lade Benutzer...</p>
                        </div>
                    </div>

                    <div class="admin-section">
                        <h3>üìß E-Mail-Einstellungen</h3>
                        <p>Konfiguration des SMTP-Servers f√ºr Benachrichtigungen.</p>
                        <div class="controls">
                            <button onclick="showEmailSettingsModal()" class="btn-primary">E-Mail-Einstellungen bearbeiten</button>
                            <button onclick="loadEmailSettings()" class="btn-secondary">Aktuelle Einstellungen laden</button>
                        </div>
                        <div id="email-settings-content">
                            <div class="info-box">
                                <p><strong>Aktive Konfiguration:</strong> Noch keine E-Mail-Einstellungen konfiguriert.</p>
                                <p>Klicken Sie auf "E-Mail-Einstellungen bearbeiten" um eine neue Konfiguration zu erstellen.</p>
                            </div>
                        </div>
                    </div>

                    <div class="admin-section">
                        <h3>üîß Globale Einstellungen</h3>
                        <p>Allgemeine Systemeinstellungen und Parameter.</p>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label>Maximale Arbeitsstunden pro Monat:</label>
                                <input type="number" id="setting-max-hours-month" value="192" min="1" max="300">
                            </div>
                            <div class="setting-item">
                                <label>Maximale Arbeitsstunden pro Woche:</label>
                                <input type="number" id="setting-max-hours-week" value="48" min="1" max="60">
                            </div>
                            <div class="setting-item">
                                <label>Maximale aufeinanderfolgende Schichten:</label>
                                <input type="number" id="setting-max-consecutive-shifts" value="6" min="1" max="10">
                            </div>
                            <div class="setting-item">
                                <label>Maximale aufeinanderfolgende Nachtschichten:</label>
                                <input type="number" id="setting-max-consecutive-nights" value="3" min="1" max="7">
                            </div>
                        </div>
                        <button onclick="saveGlobalSettings()" class="btn-primary">Einstellungen speichern</button>
                    </div>

                    <div class="admin-section">
                        <h3>üìä System-Information</h3>
                        <div class="info-box">
                            <p><strong>Version:</strong> 1.2</p>
                            <p><strong>Entwickler:</strong> Timo Braun</p>
                            <p><strong>Datenbank:</strong> SQLite</p>
                            <p><strong>Backend:</strong> ASP.NET Core 10.0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manual/Help View -->
            <div id="manual-view" class="view">
                <div class="manual-content">
                    <h2>üìñ Betriebshandbuch - Dienstplan-System</h2>
                    
                    <div class="manual-toc">
                        <h3>Inhaltsverzeichnis</h3>
                        <ul>
                            <li><a href="#manual-intro">1. Einf√ºhrung</a></li>
                            <li><a href="#manual-login">2. Anmeldung</a></li>
                            <li><a href="#manual-schedule">3. Dienstplan verwalten</a></li>
                            <li><a href="#manual-employees">4. Mitarbeiter verwalten</a></li>
                            <li><a href="#manual-vacation">5. Urlaubsverwaltung</a></li>
                            <li><a href="#manual-exchange">6. Diensttausch</a></li>
                            <li><a href="#manual-statistics">7. Statistiken</a></li>
                            <li><a href="#manual-email">8. E-Mail-Einstellungen</a></li>
                            <li><a href="#manual-rules">9. Schichtplanungsregeln</a></li>
                            <li><a href="#manual-springer">10. Springer-System</a></li>
                            <li><a href="#manual-troubleshooting">11. Problembehebung</a></li>
                        </ul>
                    </div>

                    <section id="manual-intro" class="manual-section">
                        <h3>1. Einf√ºhrung</h3>
                        <p>Das Dienstplan-System unterst√ºtzt Sie bei der Verwaltung von Schichtpl√§nen f√ºr bis zu 17 Stammpersonal-Mitarbeiter plus Ferienjobber in 3 Teams.</p>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/8fbba678-8a94-4e95-aae2-cfea5dcf19f8" alt="Dienstplan Hauptansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 1: Hauptansicht des Dienstplans (Wochenansicht)</p>
                        </div>
                        
                        <h4>Hauptfunktionen:</h4>
                        <ul>
                            <li><strong>Automatische Schichtplanung:</strong> Das System erstellt automatisch Schichtpl√§ne unter Beachtung aller gesetzlichen und betrieblichen Regeln</li>
                            <li><strong>Mitarbeiterverwaltung:</strong> Verwalten Sie Mitarbeiter, Teams und Abwesenheiten mit erweiterten Daten (E-Mail, Geburtsdatum, Funktion)</li>
                            <li><strong>Urlaubsverwaltung:</strong> Mitarbeiter k√∂nnen Urlaubsantr√§ge einreichen, die vom Disponent genehmigt werden</li>
                            <li><strong>Diensttausch-System:</strong> Mitarbeiter k√∂nnen Dienste untereinander tauschen (mit Genehmigung)</li>
                            <li><strong>Springer-System:</strong> Automatische Zuweisung von Vertretungen bei Ausf√§llen</li>
                            <li><strong>Statistiken:</strong> √úbersicht √ºber Arbeitsstunden, Schichtverteilung, Wochenend-Dienste und Auslastung</li>
                            <li><strong>E-Mail-Benachrichtigungen:</strong> Konfigurierbare E-Mail-Benachrichtigungen f√ºr alle Beteiligten</li>
                        </ul>
                    </section>

                    <section id="manual-login" class="manual-section">
                        <h3>2. Anmeldung</h3>
                        <p>F√ºr die Nutzung des Systems ben√∂tigen Sie einen Benutzeraccount mit entsprechenden Berechtigungen:</p>
                        <ul>
                            <li><strong>Administrator:</strong> Volle Berechtigung f√ºr alle Funktionen</li>
                            <li><strong>Disponent:</strong> Schichtplanung und Bearbeitung</li>
                            <li><strong>Mitarbeiter:</strong> Nur Lesezugriff auf eigenen Dienstplan</li>
                        </ul>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/9ca2ea96-c4aa-4dc6-818c-cae725b95a18" alt="Anmeldedialog" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 2: Anmeldedialog mit Rollenbasierter Zugriffskontrolle</p>
                        </div>
                        
                        <p class="note"><strong>Hinweis:</strong> Wenden Sie sich an Ihren Administrator, um einen Account zu erhalten.</p>
                    </section>

                    <section id="manual-schedule" class="manual-section">
                        <h3>3. Dienstplan verwalten</h3>
                        <h4>Dienstplan anzeigen</h4>
                        <p>W√§hlen Sie im Hauptmen√º "Dienstplan" aus. Sie k√∂nnen zwischen folgenden Ansichten w√§hlen:</p>
                        <ul>
                            <li><strong>Woche:</strong> Detaillierte Ansicht f√ºr 7 Tage</li>
                            <li><strong>Monat:</strong> √úbersicht f√ºr 30 Tage</li>
                            <li><strong>Jahr:</strong> Jahres√ºbersicht</li>
                        </ul>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/ac4101b2-856b-4b89-a370-b2c5b1663560" alt="Dienstplan Wochenansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3a: Dienstplan in der Wochenansicht (KW 50 2025)</p>
                        </div>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/5bb766a6-50b0-4e9b-88e8-4985c92499c9" alt="Dienstplan Monatsansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3b: Dienstplan in der Monatsansicht (Dezember 2025)</p>
                        </div>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/3c137b20-28d4-4335-bbfb-1680fee54f21" alt="Dienstplan Jahresansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3c: Dienstplan in der Jahresansicht (2025)</p>
                        </div>
                        
                        <h4>Schichten automatisch planen</h4>
                        <ol>
                            <li>Klicken Sie auf "Schichten planen"</li>
                            <li>W√§hlen Sie den Zeitraum aus</li>
                            <li>Best√§tigen Sie die Planung</li>
                        </ol>
                        <p>Das System erstellt automatisch einen optimalen Schichtplan unter Beachtung aller Regeln.</p>

                        <h4>Manuelle Anpassungen</h4>
                        <p>Sie k√∂nnen jederzeit manuelle √Ñnderungen am Dienstplan vornehmen:</p>
                        <ul>
                            <li>Einzelne Schichten k√∂nnen individuell zugewiesen werden</li>
                            <li>Manuelle Zuweisungen werden vom System respektiert und nicht √ºberschrieben</li>
                        </ul>
                    </section>

                    <section id="manual-employees" class="manual-section">
                        <h3>4. Mitarbeiter verwalten</h3>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/ca549d88-f312-4557-8978-a0e49ef92612" alt="Mitarbeiterverwaltung" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung: Mitarbeiterverwaltung</p>
                        </div>
                        
                        <h4>Neuen Mitarbeiter anlegen</h4>
                        <ol>
                            <li>Wechseln Sie zur Ansicht "Mitarbeiter"</li>
                            <li>Klicken Sie auf "+ Mitarbeiter hinzuf√ºgen"</li>
                            <li>F√ºllen Sie die Pflichtfelder aus:
                                <ul>
                                    <li>Vorname</li>
                                    <li>Name</li>
                                    <li>Personalnummer (eindeutig)</li>
                                </ul>
                            </li>
                            <li>Optionale Felder:
                                <ul>
                                    <li><strong>E-Mail:</strong> F√ºr Benachrichtigungen</li>
                                    <li><strong>Geburtsdatum:</strong> F√ºr Personalverwaltung</li>
                                    <li><strong>Funktion:</strong> Z.B. Brandmeldetechniker, Brandschutzbeauftragter</li>
                                    <li><strong>Springer:</strong> Markieren f√ºr Vertretungspool</li>
                                    <li><strong>Ferienjobber:</strong> F√ºr tempor√§re Mitarbeiter</li>
                                </ul>
                            </li>
                            <li>Klicken Sie auf "Speichern"</li>
                        </ol>

                        <h4>Abwesenheiten erfassen</h4>
                        <p>Erfassen Sie Abwesenheiten direkt √ºber die API oder das Mitarbeiter-Profil:</p>
                        <ul>
                            <li><strong>Krank:</strong> Krankheitstage</li>
                            <li><strong>Urlaub:</strong> Geplanter Urlaub (alternativ √ºber Urlaubsantragssystem)</li>
                            <li><strong>Lehrgang:</strong> Schulungen und Weiterbildungen</li>
                        </ul>
                    </section>

                    <section id="manual-vacation" class="manual-section">
                        <h3>5. Urlaubsverwaltung</h3>
                        <p>Das System bietet ein vollst√§ndiges Urlaubsantragssystem mit Workflow-Management.</p>
                        
                        <h4>Urlaubsantrag stellen (Mitarbeiter)</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/vacationrequests</code></li>
                            <li>Geben Sie Startdatum und Enddatum an</li>
                            <li>Optional: F√ºgen Sie eine Notiz hinzu</li>
                            <li>Der Status wird zun√§chst auf "In Bearbeitung" gesetzt</li>
                        </ol>

                        <h4>Urlaub genehmigen/ablehnen (Disponent/Admin)</h4>
                        <ol>
                            <li>Rufen Sie offene Antr√§ge ab: <code>GET /api/vacationrequests/pending</code></li>
                            <li>Pr√ºfen Sie den Antrag</li>
                            <li>Setzen Sie den Status auf "Genehmigt" oder "Nicht genehmigt": <code>PUT /api/vacationrequests/{id}/status</code></li>
                            <li>Optional: F√ºgen Sie eine Antwort/Begr√ºndung hinzu</li>
                        </ol>

                        <p><strong>Hinweis:</strong> Genehmigte Urlaubsantr√§ge werden automatisch als Abwesenheiten vom Typ "Urlaub" in den Kalender eingetragen.</p>
                    </section>

                    <section id="manual-exchange" class="manual-section">
                        <h3>6. Diensttausch</h3>
                        <p>Mitarbeiter k√∂nnen Dienste untereinander tauschen, mit Genehmigungspflicht durch den Disponent.</p>
                        
                        <h4>Dienst zum Tausch anbieten (Mitarbeiter)</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/shiftexchanges</code></li>
                            <li>Geben Sie die Schicht-ID an, die getauscht werden soll</li>
                            <li>Optional: Geben Sie einen Grund an</li>
                            <li>Der Dienst wird als "Angeboten" markiert</li>
                        </ol>

                        <h4>Angebotenen Dienst anfragen (Mitarbeiter)</h4>
                        <ol>
                            <li>Verf√ºgbare Tauschangebote anzeigen: <code>GET /api/shiftexchanges/available</code></li>
                            <li>Gew√ºnschten Dienst anfragen: <code>POST /api/shiftexchanges/{id}/request</code></li>
                            <li>Status wechselt zu "Angefragt"</li>
                        </ol>

                        <h4>Tausch genehmigen (Disponent/Admin)</h4>
                        <ol>
                            <li>Offene Tauschanfragen anzeigen: <code>GET /api/shiftexchanges/pending</code></li>
                            <li>Tausch pr√ºfen und genehmigen/ablehnen: <code>PUT /api/shiftexchanges/{id}/process</code></li>
                            <li>Bei Genehmigung wird die Schicht automatisch umgeschichtet</li>
                        </ol>

                        <p><strong>Wichtig:</strong> Auch bei genehmigten Tauschen werden die Ruhezeiten und Planungsregeln gepr√ºft!</p>
                    </section>

                    <section id="manual-statistics" class="manual-section">
                        <h3>7. Statistiken</h3>
                        
                        <div class="manual-screenshot">
                            <img src="https://github.com/user-attachments/assets/016fab62-3005-40fa-aebd-a6e6c187cc15" alt="Statistiken" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung: Statistiken und Auswertungen</p>
                        </div>
                        
                        <p>Die Statistik-Ansicht bietet Ihnen einen √úberblick √ºber:</p>
                        <ul>
                            <li><strong>Arbeitsstunden:</strong> Gesamtstunden und Schichtanzahl pro Mitarbeiter</li>
                            <li><strong>Schichtverteilung:</strong> Verteilung der Schichtarten pro Team</li>
                            <li><strong>Fehltage:</strong> √úbersicht der Abwesenheiten nach Typ</li>
                            <li><strong>Team-Auslastung:</strong> Durchschnittliche Schichten pro Mitarbeiter</li>
                            <li><strong>Wochenend-Statistiken (Admin/Disponent):</strong> Samstags- und Sonntagsdienste je Mitarbeiter</li>
                        </ul>
                        <p>W√§hlen Sie den gew√ºnschten Zeitraum aus und klicken Sie auf "Aktualisieren".</p>
                        
                        <h4>Wochenend-Statistiken abrufen</h4>
                        <p>Als Administrator oder Disponent k√∂nnen Sie detaillierte Wochenend-Statistiken abrufen:</p>
                        <code>GET /api/statistics/weekend-shifts?startDate=2025-01-01&endDate=2025-12-31</code>
                    </section>

                    <section id="manual-email" class="manual-section">
                        <h3>8. E-Mail-Einstellungen</h3>
                        <p>Als Administrator k√∂nnen Sie die E-Mail-Server-Einstellungen konfigurieren, um automatische Benachrichtigungen zu erm√∂glichen.</p>
                        
                        <h4>E-Mail-Konfiguration anlegen</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/emailsettings</code></li>
                            <li>Erforderliche Einstellungen:
                                <ul>
                                    <li><strong>SMTP Server:</strong> Hostname oder IP-Adresse (z.B. smtp.gmail.com)</li>
                                    <li><strong>Port:</strong> Standard 587 f√ºr STARTTLS, 465 f√ºr SSL, 25 f√ºr unverschl√ºsselt</li>
                                    <li><strong>Protokoll:</strong> SMTP oder SMTPS</li>
                                    <li><strong>Sicherheit:</strong> None, SSL, TLS oder STARTTLS</li>
                                    <li><strong>Authentifizierung:</strong> Ja/Nein</li>
                                    <li><strong>Benutzername:</strong> Falls Authentifizierung erforderlich</li>
                                    <li><strong>Passwort:</strong> Falls Authentifizierung erforderlich</li>
                                    <li><strong>Absenderadresse:</strong> z.B. dienstplan@fritzwinter.de</li>
                                    <li><strong>Absendername:</strong> z.B. "Dienstplan-System"</li>
                                    <li><strong>Antwortadresse:</strong> Optional, falls abweichend</li>
                                </ul>
                            </li>
                        </ol>

                        <h4>Mitarbeiter-E-Mails pflegen</h4>
                        <p>Erfassen Sie E-Mail-Adressen f√ºr jeden Mitarbeiter, der Benachrichtigungen erhalten soll:</p>
                        <ol>
                            <li>√ñffnen Sie den Mitarbeiter zur Bearbeitung</li>
                            <li>Tragen Sie die E-Mail-Adresse im Feld "E-Mail" ein</li>
                            <li>Speichern Sie die √Ñnderungen</li>
                        </ol>

                        <h4>Aktive Konfiguration abrufen</h4>
                        <code>GET /api/emailsettings/active</code>

                        <p><strong>Sicherheitshinweis:</strong> Das System zeigt Passw√∂rter niemals in API-Antworten an. Passw√∂rter sollten vor der Speicherung verschl√ºsselt werden.</p>
                    </section>

                    <section id="manual-rules" class="manual-section">
                        <h3>9. Schichtplanungsregeln</h3>
                        <p>Das System beachtet automatisch folgende Regeln:</p>
                        
                        <h4>Schichtarten</h4>
                        <table class="rules-table">
                            <tr>
                                <th>Schicht</th>
                                <th>Code</th>
                                <th>Uhrzeit</th>
                            </tr>
                            <tr>
                                <td>Fr√ºhdienst</td>
                                <td class="shift-badge shift-F">F</td>
                                <td>05:45 ‚Äì 13:45</td>
                            </tr>
                            <tr>
                                <td>Sp√§tdienst</td>
                                <td class="shift-badge shift-S">S</td>
                                <td>13:45 ‚Äì 21:45</td>
                            </tr>
                            <tr>
                                <td>Nachtdienst</td>
                                <td class="shift-badge shift-N">N</td>
                                <td>21:45 ‚Äì 05:45</td>
                            </tr>
                            <tr>
                                <td>Zwischendienst</td>
                                <td class="shift-badge shift-ZD">ZD</td>
                                <td>08:00 ‚Äì 16:00</td>
                            </tr>
                        </table>

                        <h4>Besetzungsregeln</h4>
                        <p><strong>Montag bis Freitag:</strong></p>
                        <ul>
                            <li>Fr√ºhdienst: 4-5 Personen</li>
                            <li>Sp√§tdienst: 3-4 Personen</li>
                            <li>Nachtdienst: 3 Personen</li>
                        </ul>
                        <p><strong>Samstag und Sonntag:</strong></p>
                        <ul>
                            <li>Alle Schichten: maximal 3 Personen</li>
                        </ul>

                        <h4>Verbotene Schichtwechsel</h4>
                        <ul>
                            <li>‚ùå Sp√§tdienst ‚Üí Fr√ºhdienst (zu kurze Ruhezeit)</li>
                            <li>‚ùå Nachtdienst ‚Üí Sp√§tdienst (zu kurze Ruhezeit)</li>
                            <li>‚ùå Gleiche Schicht zweimal hintereinander</li>
                        </ul>

                        <h4>Idealer Rhythmus</h4>
                        <p>Fr√ºhdienst ‚Üí Nachtdienst ‚Üí Sp√§tdienst</p>
                        <p>Dieser Rhythmus erm√∂glicht optimale Ruhezeiten und Belastungsverteilung.</p>

                        <h4>Ruhezeiten</h4>
                        <p>Mindestens 11 Stunden Ruhezeit zwischen zwei Schichten (gesetzlich vorgeschrieben).</p>
                    </section>

                    <section id="manual-springer" class="manual-section">
                        <h3>10. Springer-System</h3>
                        <p>Das Springer-System sorgt f√ºr automatische Vertretung bei kurzfristigen Ausf√§llen.</p>
                        
                        <h4>Springer definieren</h4>
                        <p>Markieren Sie beim Anlegen oder Bearbeiten eines Mitarbeiters das Feld "Springer".</p>
                        
                        <h4>Automatische Zuweisung</h4>
                        <p>Bei Erfassung einer Abwesenheit pr√ºft das System automatisch:</p>
                        <ol>
                            <li>Welche Schichten betroffen sind</li>
                            <li>Welche Springer verf√ºgbar sind</li>
                            <li>Weist den ersten verf√ºgbaren Springer zu</li>
                        </ol>
                        <p class="note"><strong>Hinweis:</strong> Springer werden nur bei tats√§chlichen Ausf√§llen eingesetzt, nicht bei der regul√§ren Planung.</p>
                    </section>

                    <section id="manual-troubleshooting" class="manual-section">
                        <h3>11. Problembehebung</h3>
                        
                        <h4>Problem: Schichtplanung schl√§gt fehl</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Pr√ºfen Sie, ob gen√ºgend Mitarbeiter verf√ºgbar sind</li>
                            <li>√úberpr√ºfen Sie bestehende Abwesenheiten</li>
                            <li>Stellen Sie sicher, dass mindestens 12-15 Mitarbeiter angelegt sind</li>
                        </ul>

                        <h4>Problem: Kein Springer verf√ºgbar</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Definieren Sie weitere Mitarbeiter als Springer</li>
                            <li>Pr√ºfen Sie Abwesenheiten der Springer</li>
                            <li>Bei Bedarf: Manuelle Zuweisung einer Vertretung</li>
                        </ul>

                        <h4>Problem: Statistiken werden nicht angezeigt</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Pr√ºfen Sie den ausgew√§hlten Zeitraum</li>
                            <li>Stellen Sie sicher, dass Schichten f√ºr diesen Zeitraum vorhanden sind</li>
                            <li>Aktualisieren Sie die Seite (F5)</li>
                        </ul>

                        <h4>Weitere Hilfe</h4>
                        <p>Bei weiteren Fragen wenden Sie sich bitte an:</p>
                        <ul>
                            <li>IT-Support: support@fritzwinter.de</li>
                            <li>Telefon: +49 XXX XXXXXXX</li>
                        </ul>
                    </section>

                    <div class="manual-footer">
                        <p><strong>Version:</strong> 1.2</p>
                        <p><strong>Entwickelt von:</strong> Timo Braun</p>
                        <p><strong>Letzte Aktualisierung:</strong> Dezember 2025</p>
                        <p>¬© Fritz Winter Eisengie√üerei GmbH & Co. KG</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for adding employee -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmployeeModal()">&times;</span>
            <h2>Mitarbeiter hinzuf√ºgen</h2>
            <form id="employeeForm" onsubmit="saveEmployee(event)">
                <div class="form-group">
                    <label>Vorname*</label>
                    <input type="text" id="vorname" required>
                </div>
                <div class="form-group">
                    <label>Name*</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label>Personalnummer*</label>
                    <input type="text" id="personalnummer" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isSpringer">
                        Springer
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeEmployeeModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2>Anmelden</h2>
            <form id="loginForm" onsubmit="login(event)">
                <div class="form-group">
                    <label>E-Mail*</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort*</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="rememberMe">
                        Angemeldet bleiben
                    </label>
                </div>
                <div id="loginError" class="error-message" style="display: none;"></div>
                <div class="form-actions">
                    <button type="button" onclick="closeLoginModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Anmelden</button>
                </div>
            </form>
            <div class="login-info">
                <p><strong>Standard-Anmeldedaten:</strong></p>
                <p>E-Mail: admin@fritzwinter.de</p>
                <p>Passwort: Admin123!</p>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <p><strong>Dienstplan-System v1.2</strong></p>
                <p>¬© 2025 Fritz Winter Eisengie√üerei GmbH & Co. KG</p>
            </div>
            <div class="footer-right">
                <p>Entwickelt von <strong>Timo Braun</strong></p>
                <p>Letzte Aktualisierung: Dezember 2025</p>
            </div>
        </div>
    </footer>

    <script src="/js/app.js"></script>
</body>
</html>
