<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dienstplan - Schichtverwaltung</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="/images/fw-logo-white.svg" alt="Fritz Winter Logo" class="company-logo-img">
                    <div class="divider"></div>
                    <h1>Dienstplan - Schichtverwaltung</h1>
                </div>
                <div class="header-right">
                    <nav>
                        <button onclick="showView('schedule')" class="nav-btn active">Dienstplan</button>
                        <button onclick="showView('employees')" class="nav-btn">Mitarbeiter</button>
                        <button onclick="showView('teams')" class="nav-btn">Teams</button>
                        <button onclick="showView('absences')" class="nav-btn" id="nav-absences" style="display:none;">Abwesenheiten</button>
                        <button onclick="showView('shiftexchange')" class="nav-btn" id="nav-shiftexchange" style="display:none;">Diensttausch</button>
                        <button onclick="showView('statistics')" class="nav-btn">Statistiken</button>
                        <button onclick="showView('manual')" class="nav-btn">üìñ Hilfe</button>
                        <button onclick="showView('admin')" class="nav-btn admin-only" id="nav-admin" style="display:none;">‚öôÔ∏è Admin</button>
                    </nav>
                    <div id="notification-bell" class="notification-bell admin-only" style="display:none;" onclick="showNotificationModal()">
                        <span class="bell-icon">üîî</span>
                        <span id="notification-badge" class="notification-badge" style="display:none;">0</span>
                    </div>
                    <div id="user-info" class="user-info" style="display: none;">
                        <span id="user-name"></span>
                        <button onclick="logout()" class="btn-logout">Abmelden</button>
                    </div>
                    <div id="login-prompt" class="login-prompt">
                        <button onclick="showLoginModal()" class="btn-login">Anmelden</button>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <!-- Schedule View -->
            <div id="schedule-view" class="view active">
                <!-- View Tabs -->
                <div class="schedule-tabs">
                    <button class="schedule-tab active" onclick="switchScheduleView('week', this)">üìÖ Woche</button>
                    <button class="schedule-tab" onclick="switchScheduleView('month', this)">üìÜ Monat</button>
                    <button class="schedule-tab" onclick="switchScheduleView('year', this)">üìä Jahr</button>
                </div>
                
                <div class="controls">
                    <!-- Week View Controls -->
                    <div id="week-controls" class="date-controls">
                        <button onclick="changeDate(-1)">‚óÄ Vorherige Woche</button>
                        <input type="date" id="startDate" onchange="loadSchedule()">
                        <button onclick="changeDate(1)">N√§chste Woche ‚ñ∂</button>
                    </div>
                    
                    <!-- Month View Controls -->
                    <div id="month-controls" class="date-controls" style="display: none;">
                        <button onclick="changeMonth(-1)">‚óÄ Vorheriger Monat</button>
                        <select id="monthSelect" onchange="loadSchedule()">
                            <option value="1">Januar</option>
                            <option value="2">Februar</option>
                            <option value="3">M√§rz</option>
                            <option value="4">April</option>
                            <option value="5">Mai</option>
                            <option value="6">Juni</option>
                            <option value="7">Juli</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12">Dezember</option>
                        </select>
                        <select id="monthYearSelect" onchange="loadSchedule()"></select>
                        <button onclick="changeMonth(1)">N√§chster Monat ‚ñ∂</button>
                    </div>
                    
                    <!-- Year View Controls -->
                    <div id="year-controls" class="date-controls" style="display: none;">
                        <button onclick="changeYear(-1)">‚óÄ Vorheriges Jahr</button>
                        <select id="yearSelect" onchange="loadSchedule()"></select>
                        <button onclick="changeYear(1)">N√§chstes Jahr ‚ñ∂</button>
                    </div>
                    
                    <div class="view-controls">
                        <button onclick="showPlanShiftsModal()" class="btn-primary admin-only">Schichten planen</button>
                        <button onclick="showNewShiftModal()" class="btn-primary admin-only">+ Neue Schicht</button>
                        <button onclick="toggleMultiSelectMode()" id="multiSelectToggleBtn" class="btn-secondary admin-only">‚òë Mehrfachauswahl</button>
                        <button onclick="showBulkEditModal()" id="bulkEditBtn" class="btn-primary admin-only" style="display:none;">‚úè Auswahl bearbeiten</button>
                        <button onclick="clearShiftSelection()" id="clearSelectionBtn" class="btn-secondary admin-only" style="display:none;">‚úñ Auswahl l√∂schen</button>
                        <span id="selectionCounter" style="margin-left: 10px; font-weight: bold; color: #2196F3;"></span>
                        <button onclick="exportScheduleToCsv()" class="btn-secondary">üìä CSV Export</button>
                        <button onclick="exportScheduleToPdf()" class="btn-secondary">üìÑ PDF Export</button>
                        <button onclick="exportScheduleToExcel()" class="btn-secondary">üìä Excel Export</button>
                    </div>
                </div>
                
                <div id="schedule-content" class="schedule-grid">
                    <p class="loading">Lade Dienstplan...</p>
                </div>
            </div>

            <!-- Employees View -->
            <div id="employees-view" class="view">
                <div class="controls">
                    <button onclick="showAddEmployeeModal()" class="btn-primary admin-only">+ Mitarbeiter hinzuf√ºgen</button>
                </div>
                <div id="employees-content">
                    <p class="loading">Lade Mitarbeiter...</p>
                </div>
            </div>

            <!-- Statistics View -->
            <div id="statistics-view" class="view">
                <div class="controls">
                    <div class="date-range">
                        <label>Von: <input type="date" id="statsStartDate"></label>
                        <label>Bis: <input type="date" id="statsEndDate"></label>
                        <button onclick="loadStatistics()" class="btn-primary">Aktualisieren</button>
                    </div>
                </div>
                <div id="statistics-content">
                    <p class="loading">Lade Statistiken...</p>
                </div>
            </div>

            <!-- Teams View -->
            <div id="teams-view" class="view">
                <div class="controls">
                    <button onclick="showAddTeamModal()" class="btn-primary admin-only">+ Team hinzuf√ºgen</button>
                </div>
                <div id="teams-content">
                    <p class="loading">Lade Teams...</p>
                </div>
            </div>

            <!-- Vacations View -->
            <div id="absences-view" class="view">
                <h2>Abwesenheitsverwaltung</h2>
                
                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchAbsenceTab('vacation')">Urlaub</button>
                    <button class="tab-btn" onclick="switchAbsenceTab('sick')">Arbeitsunf√§higkeit (AU)</button>
                    <button class="tab-btn" onclick="switchAbsenceTab('training')">Lehrgang / Schulung</button>
                </div>
                
                <!-- Vacation Tab -->
                <div id="vacation-tab" class="tab-content active">
                    <h3>Urlaubsverwaltung</h3>
                    <p class="info">Urlaubsantr√§ge m√ºssen vom Disponent genehmigt werden.</p>
                    <div class="controls">
                        <button onclick="showAddVacationRequestModal()" class="btn-primary">+ Urlaubsantrag stellen</button>
                        <button onclick="loadVacationRequests('pending')" class="btn-secondary admin-only">Offene Antr√§ge</button>
                        <button onclick="loadVacationRequests('all')" class="btn-secondary admin-only">Alle Antr√§ge</button>
                        <button onclick="loadVacationRequests('my')" class="btn-secondary">Meine Antr√§ge</button>
                    </div>
                    <div id="vacation-requests-content">
                        <p class="loading">Lade Urlaubsantr√§ge...</p>
                    </div>
                </div>
                
                <!-- Sick Leave Tab -->
                <div id="sick-tab" class="tab-content">
                    <h3>Arbeitsunf√§higkeit (AU)</h3>
                    <p class="info">AU-Meldungen werden ohne Genehmigungsprozess direkt erfasst.</p>
                    <div class="controls">
                        <button onclick="showAddAbsenceModal('AU')" class="btn-primary admin-only">+ AU erfassen</button>
                        <button onclick="loadAbsences('AU')" class="btn-secondary">Alle AU anzeigen</button>
                    </div>
                    <div id="sick-absences-content">
                        <p class="loading">Lade Arbeitsunf√§higkeiten...</p>
                    </div>
                </div>
                
                <!-- Training Tab -->
                <div id="training-tab" class="tab-content">
                    <h3>Lehrgang / Schulung / Training</h3>
                    <p class="info">Lehrg√§nge und Schulungen werden ohne Genehmigungsprozess direkt erfasst.</p>
                    <div class="controls">
                        <button onclick="showAddAbsenceModal('L')" class="btn-primary admin-only">+ Lehrgang erfassen</button>
                        <button onclick="loadAbsences('L')" class="btn-secondary">Alle Lehrg√§nge anzeigen</button>
                    </div>
                    <div id="training-absences-content">
                        <p class="loading">Lade Lehrg√§nge...</p>
                    </div>
                </div>
            </div>

            <!-- Shift Exchange View (separate from vacation) -->
            <div id="shiftexchange-view" class="view">
                <h2>Diensttausch</h2>
                <div class="controls">
                    <button onclick="showOfferShiftExchangeModal()" class="btn-primary">+ Dienst zum Tausch anbieten</button>
                    <button onclick="loadShiftExchanges('available')" class="btn-secondary">Verf√ºgbare Dienste</button>
                    <button onclick="loadShiftExchanges('pending')" class="btn-secondary admin-only">Offene Anfragen</button>
                    <button onclick="loadShiftExchanges('my')" class="btn-secondary">Meine Tauschangebote</button>
                </div>
                <div id="shift-exchanges-content">
                    <p class="loading">Lade Diensttausch-Angebote...</p>
                </div>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="view">
                <h2>‚öôÔ∏è Administration</h2>
                
                <!-- Admin Navigation Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showAdminTab('users', this)">üë• Benutzerverwaltung</button>
                    <button class="admin-tab" onclick="showAdminTab('shift-management', this)">üîÑ Schichtverwaltung</button>
                    <button class="admin-tab" onclick="showAdminTab('vacation-periods', this)">üìÖ Ferienzeiten</button>
                    <button class="admin-tab" onclick="showAdminTab('audit-logs', this)">üìã √Ñnderungsprotokoll</button>
                    <button class="admin-tab" onclick="showAdminTab('email', this)">üìß E-Mail-Einstellungen</button>
                    <button class="admin-tab" onclick="showAdminTab('settings', this)">üîß Globale Einstellungen</button>
                    <button class="admin-tab" onclick="showAdminTab('system', this)">üìä System-Information</button>
                </div>

                <!-- Tab Contents -->
                <div class="admin-tab-contents">
                    <!-- Users Tab -->
                    <div id="admin-tab-users" class="admin-tab-content active">
                        <div class="admin-section">
                            <h3>üë• Benutzerverwaltung</h3>
                            <p>Verwaltung von Benutzerkonten, Passw√∂rtern und Rollen.</p>
                            <div class="controls">
                                <button onclick="showAddUserModal()" class="btn-primary">+ Benutzer hinzuf√ºgen</button>
                            </div>
                            <div id="users-content">
                                <p class="loading">Lade Benutzer...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Shift Management Tab -->
                    <div id="admin-tab-shift-management" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üîÑ Schichtverwaltung</h3>
                            <p>Verwalten Sie Schichtmodelle, Arbeitszeiten, K√ºrzel und Farben. Definieren Sie, welche Teams welche Schichten arbeiten k√∂nnen.</p>
                            <div class="controls">
                                <button onclick="showShiftTypeModal()" class="btn-primary">+ Schichttyp hinzuf√ºgen</button>
                                <button onclick="loadShiftTypes()" class="btn-secondary">üîÑ Aktualisieren</button>
                            </div>
                            <div id="shift-types-content">
                                <p class="loading">Lade Schichttypen...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Vacation Periods Tab -->
                    <div id="admin-tab-vacation-periods" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üìÖ Ferienzeiten verwalten</h3>
                            <p>Definieren Sie Ferienzeitr√§ume (Sommer, Herbst, Weihnachten, Ostern usw.). Diese werden in den Kalenderansichten als oberste Zeile angezeigt.</p>
                            <div class="controls">
                                <button onclick="showVacationPeriodModal()" class="btn-primary">+ Ferienzeit hinzuf√ºgen</button>
                            </div>
                            <div id="vacation-periods-content">
                                <p class="loading">Lade Ferienzeiten...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Logs Tab -->
                    <div id="admin-tab-audit-logs" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üìã √Ñnderungsprotokoll (Audit Log)</h3>
                            <p>Protokoll aller System√§nderungen f√ºr Nachverfolgbarkeit und Compliance.</p>
                            
                            <!-- Filter Controls -->
                            <div class="audit-filters">
                                <div class="filter-group">
                                    <label>Entit√§t:</label>
                                    <select id="audit-filter-entity">
                                        <option value="">Alle</option>
                                        <option value="Employee">Employee</option>
                                        <option value="ShiftAssignment">ShiftAssignment</option>
                                        <option value="Team">Team</option>
                                        <option value="Absence">Absence</option>
                                        <option value="VacationRequest">VacationRequest</option>
                                        <option value="ShiftExchange">ShiftExchange</option>
                                        <option value="EmailSettings">EmailSettings</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Aktion:</label>
                                    <select id="audit-filter-action">
                                        <option value="">Alle</option>
                                        <option value="Created">Created</option>
                                        <option value="Updated">Updated</option>
                                        <option value="Deleted">Deleted</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Von Datum:</label>
                                    <input type="date" id="audit-filter-start-date">
                                </div>
                                <div class="filter-group">
                                    <label>Bis Datum:</label>
                                    <input type="date" id="audit-filter-end-date">
                                </div>
                                <div class="filter-group">
                                    <button onclick="applyAuditFilters()" class="btn-primary">Filter anwenden</button>
                                    <button onclick="clearAuditFilters()" class="btn-secondary">Zur√ºcksetzen</button>
                                </div>
                            </div>
                            
                            <div class="controls">
                                <button onclick="loadAuditLogs(1, 50)" class="btn-primary">Eintr√§ge laden</button>
                                <div style="display: inline-block; margin-left: 20px;">
                                    <span id="audit-auto-refresh-status" style="color: #999;">‚è∏ Auto-Aktualisierung: Inaktiv</span>
                                </div>
                            </div>
                            <div id="audit-logs-content">
                                <p class="loading">Lade √Ñnderungsprotokoll...</p>
                            </div>
                            
                            <!-- Pagination -->
                            <div id="audit-pagination" class="pagination" style="display: none;">
                                <button onclick="loadAuditLogsPreviousPage()" id="audit-prev-btn" class="btn-secondary">‚Üê Vorherige</button>
                                <span id="audit-page-info">Seite 1</span>
                                <button onclick="loadAuditLogsNextPage()" id="audit-next-btn" class="btn-secondary">N√§chste ‚Üí</button>
                            </div>
                        </div>
                    </div>

                    <!-- Email Settings Tab -->
                    <div id="admin-tab-email" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üìß E-Mail-Einstellungen</h3>
                            <p>Konfiguration des SMTP-Servers f√ºr Benachrichtigungen.</p>
                            <div class="controls">
                                <button onclick="showEmailSettingsModal()" class="btn-primary">E-Mail-Einstellungen bearbeiten</button>
                                <button onclick="loadEmailSettings()" class="btn-secondary">Aktuelle Einstellungen laden</button>
                            </div>
                            <div id="email-settings-content">
                                <div class="info-box">
                                    <p><strong>Aktive Konfiguration:</strong> Noch keine E-Mail-Einstellungen konfiguriert.</p>
                                    <p>Klicken Sie auf "E-Mail-Einstellungen bearbeiten" um eine neue Konfiguration zu erstellen.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Global Settings Tab -->
                    <div id="admin-tab-settings" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üîß Systemeinstellungen</h3>
                            <p>Allgemeine Schichtplanungseinstellungen.</p>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label>Maximale aufeinanderfolgende Schichten:</label>
                                    <input type="number" id="setting-max-consecutive-shifts" value="6" min="1" max="10">
                                </div>
                                <div class="setting-item">
                                    <label>Maximale aufeinanderfolgende Nachtschichten:</label>
                                    <input type="number" id="setting-max-consecutive-nights" value="3" min="1" max="7">
                                </div>
                            </div>
                            <button onclick="saveGlobalSettings()" class="btn-primary">Einstellungen speichern</button>
                            
                            <div class="info-box" style="margin-top: 20px;">
                                <p><strong>Hinweis zu Arbeitszeitgrenzen:</strong></p>
                                <p>Die maximalen Arbeitszeiten (Stunden pro Woche und Monat) werden jetzt dynamisch aus der <strong>Schichtverwaltung</strong> berechnet.</p>
                                <p>Jede Schicht hat eine konfigurierbare <strong>Wochenarbeitszeit</strong>, die als Grundlage f√ºr die monatlichen Sollstunden dient.</p>
                                <p>Diese Einstellungen k√∂nnen in der Schichtverwaltung (Admin ‚Üí Schichtarten) angepasst werden.</p>
                            </div>
                        </div>
                    </div>

                    <!-- System Info Tab -->
                    <div id="admin-tab-system" class="admin-tab-content">
                        <div class="admin-section">
                            <h3>üìä System-Information</h3>
                            <div class="info-box">
                                <p><strong>Version:</strong> 2.0 - Python Edition</p>
                                <p><strong>Entwickler:</strong> Timo Braun</p>
                                <p><strong>Datenbank:</strong> SQLite</p>
                                <p><strong>Backend:</strong> Python 3.9+ mit Flask</p>
                                <p><strong>Solver:</strong> Google OR-Tools CP-SAT</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manual/Help View -->
            <div id="manual-view" class="view">
                <div class="manual-content">
                    <h2>üìñ Betriebshandbuch - Dienstplan-System</h2>
                    
                    <div class="manual-toc">
                        <h3>Inhaltsverzeichnis</h3>
                        <ul>
                            <li><a href="#manual-intro">1. Einf√ºhrung</a></li>
                            <li><a href="#manual-login">2. Anmeldung</a></li>
                            <li><a href="#manual-schedule">3. Dienstplan verwalten</a></li>
                            <li><a href="#manual-employees">4. Mitarbeiter verwalten</a></li>
                            <li><a href="#manual-vacation">5. Urlaubsverwaltung</a></li>
                            <li><a href="#manual-exchange">6. Diensttausch</a></li>
                            <li><a href="#manual-statistics">7. Statistiken</a></li>
                            <li><a href="#manual-email">8. E-Mail-Einstellungen</a></li>
                            <li><a href="#manual-rules">9. Schichtplanungsregeln</a></li>
                            <li><a href="#manual-springer">10. Springer-System</a></li>
                            <li><a href="#manual-troubleshooting">11. Problembehebung</a></li>
                        </ul>
                    </div>

                    <section id="manual-intro" class="manual-section">
                        <h3>1. Einf√ºhrung</h3>
                        <p>Das Dienstplan-System unterst√ºtzt Sie bei der Verwaltung von Schichtpl√§nen f√ºr bis zu 17 Stammpersonal-Mitarbeiter plus Ferienjobber in 3 Teams.</p>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/00-main-view.png" alt="Dienstplan Hauptansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 1: Hauptansicht des Dienstplans (Wochenansicht)</p>
                        </div>
                        
                        <h4>Hauptfunktionen:</h4>
                        <ul>
                            <li><strong>Automatische Schichtplanung:</strong> Das System erstellt automatisch Schichtpl√§ne unter Beachtung aller gesetzlichen und betrieblichen Regeln</li>
                            <li><strong>Mitarbeiterverwaltung:</strong> Verwalten Sie Mitarbeiter, Teams und Abwesenheiten mit erweiterten Daten (E-Mail, Geburtsdatum, Funktion)</li>
                            <li><strong>Urlaubsverwaltung:</strong> Mitarbeiter k√∂nnen Urlaubsantr√§ge einreichen, die vom Disponent genehmigt werden</li>
                            <li><strong>Diensttausch-System:</strong> Mitarbeiter k√∂nnen Dienste untereinander tauschen (mit Genehmigung)</li>
                            <li><strong>Springer-System:</strong> Automatische Zuweisung von Vertretungen bei Ausf√§llen</li>
                            <li><strong>Statistiken:</strong> √úbersicht √ºber Arbeitsstunden, Schichtverteilung, Wochenend-Dienste und Auslastung</li>
                            <li><strong>E-Mail-Benachrichtigungen:</strong> Konfigurierbare E-Mail-Benachrichtigungen f√ºr alle Beteiligten</li>
                        </ul>
                    </section>

                    <section id="manual-login" class="manual-section">
                        <h3>2. Anmeldung</h3>
                        <p>F√ºr die Nutzung des Systems ben√∂tigen Sie einen Benutzeraccount mit entsprechenden Berechtigungen:</p>
                        <ul>
                            <li><strong>Administrator:</strong> Volle Berechtigung f√ºr alle Funktionen</li>
                            <li><strong>Disponent:</strong> Schichtplanung und Bearbeitung</li>
                            <li><strong>Mitarbeiter:</strong> Nur Lesezugriff auf eigenen Dienstplan</li>
                        </ul>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/02-login-modal.png" alt="Anmeldedialog" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 2: Anmeldedialog mit Rollenbasierter Zugriffskontrolle</p>
                        </div>
                        
                        <p class="note"><strong>Hinweis:</strong> Wenden Sie sich an Ihren Administrator, um einen Account zu erhalten.</p>
                    </section>

                    <section id="manual-schedule" class="manual-section">
                        <h3>3. Dienstplan verwalten</h3>
                        <h4>Dienstplan anzeigen</h4>
                        <p>W√§hlen Sie im Hauptmen√º "Dienstplan" aus. Sie k√∂nnen zwischen folgenden Ansichten w√§hlen:</p>
                        <ul>
                            <li><strong>Woche:</strong> Detaillierte Ansicht f√ºr 7 Tage</li>
                            <li><strong>Monat:</strong> √úbersicht f√ºr 30 Tage</li>
                            <li><strong>Jahr:</strong> Jahres√ºbersicht</li>
                        </ul>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/03-schedule-week-admin.png" alt="Dienstplan Wochenansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3a: Dienstplan in der Wochenansicht (KW 50 2025)</p>
                        </div>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/04-schedule-month-admin.png" alt="Dienstplan Monatsansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3b: Dienstplan in der Monatsansicht (Dezember 2025)</p>
                        </div>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/05-schedule-year-admin.png" alt="Dienstplan Jahresansicht" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung 3c: Dienstplan in der Jahresansicht (2025)</p>
                        </div>
                        
                        <h4>Schichten automatisch planen</h4>
                        <ol>
                            <li>Klicken Sie auf "Schichten planen"</li>
                            <li>W√§hlen Sie den Zeitraum aus</li>
                            <li>Best√§tigen Sie die Planung</li>
                        </ol>
                        <p>Das System erstellt automatisch einen optimalen Schichtplan unter Beachtung aller Regeln.</p>

                        <h4>Manuelle Anpassungen</h4>
                        <p>Sie k√∂nnen jederzeit manuelle √Ñnderungen am Dienstplan vornehmen:</p>
                        <ul>
                            <li>Einzelne Schichten k√∂nnen individuell zugewiesen werden</li>
                            <li>Manuelle Zuweisungen werden vom System respektiert und nicht √ºberschrieben</li>
                        </ul>
                    </section>

                    <section id="manual-employees" class="manual-section">
                        <h3>4. Mitarbeiter verwalten</h3>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/06-employees-list.png" alt="Mitarbeiterverwaltung" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung: Mitarbeiterverwaltung</p>
                        </div>
                        
                        <h4>Neuen Mitarbeiter anlegen</h4>
                        <ol>
                            <li>Wechseln Sie zur Ansicht "Mitarbeiter"</li>
                            <li>Klicken Sie auf "+ Mitarbeiter hinzuf√ºgen"</li>
                            <li>F√ºllen Sie die Pflichtfelder aus:
                                <ul>
                                    <li>Vorname</li>
                                    <li>Name</li>
                                    <li>Personalnummer (eindeutig)</li>
                                </ul>
                            </li>
                            <li>Optionale Felder:
                                <ul>
                                    <li><strong>E-Mail:</strong> F√ºr Benachrichtigungen</li>
                                    <li><strong>Geburtsdatum:</strong> F√ºr Personalverwaltung</li>
                                    <li><strong>Funktion:</strong> Z.B. Brandmeldetechniker, Brandschutzbeauftragter</li>
                                    <li><strong>Springer:</strong> Markieren f√ºr Vertretungspool</li>
                                    <li><strong>Ferienjobber:</strong> F√ºr tempor√§re Mitarbeiter</li>
                                </ul>
                            </li>
                            <li>Klicken Sie auf "Speichern"</li>
                        </ol>

                        <h4>Abwesenheiten erfassen</h4>
                        <p>Erfassen Sie Abwesenheiten direkt √ºber die API oder das Mitarbeiter-Profil:</p>
                        <ul>
                            <li><strong>Krank:</strong> Krankheitstage</li>
                            <li><strong>Urlaub:</strong> Geplanter Urlaub (alternativ √ºber Urlaubsantragssystem)</li>
                            <li><strong>Lehrgang:</strong> Schulungen und Weiterbildungen</li>
                        </ul>
                    </section>

                    <section id="manual-vacation" class="manual-section">
                        <h3>5. Urlaubsverwaltung</h3>
                        <p>Das System bietet ein vollst√§ndiges Urlaubsantragssystem mit Workflow-Management.</p>
                        
                        <h4>Urlaubsantrag stellen (Mitarbeiter)</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/vacationrequests</code></li>
                            <li>Geben Sie Startdatum und Enddatum an</li>
                            <li>Optional: F√ºgen Sie eine Notiz hinzu</li>
                            <li>Der Status wird zun√§chst auf "In Bearbeitung" gesetzt</li>
                        </ol>

                        <h4>Urlaub genehmigen/ablehnen (Disponent/Admin)</h4>
                        <ol>
                            <li>Rufen Sie offene Antr√§ge ab: <code>GET /api/vacationrequests/pending</code></li>
                            <li>Pr√ºfen Sie den Antrag</li>
                            <li>Setzen Sie den Status auf "Genehmigt" oder "Nicht genehmigt": <code>PUT /api/vacationrequests/{id}/status</code></li>
                            <li>Optional: F√ºgen Sie eine Antwort/Begr√ºndung hinzu</li>
                        </ol>

                        <p><strong>Hinweis:</strong> Genehmigte Urlaubsantr√§ge werden automatisch als Abwesenheiten vom Typ "Urlaub" in den Kalender eingetragen.</p>
                    </section>

                    <section id="manual-exchange" class="manual-section">
                        <h3>6. Diensttausch</h3>
                        <p>Mitarbeiter k√∂nnen Dienste untereinander tauschen, mit Genehmigungspflicht durch den Disponent.</p>
                        
                        <h4>Dienst zum Tausch anbieten (Mitarbeiter)</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/shiftexchanges</code></li>
                            <li>Geben Sie die Schicht-ID an, die getauscht werden soll</li>
                            <li>Optional: Geben Sie einen Grund an</li>
                            <li>Der Dienst wird als "Angeboten" markiert</li>
                        </ol>

                        <h4>Angebotenen Dienst anfragen (Mitarbeiter)</h4>
                        <ol>
                            <li>Verf√ºgbare Tauschangebote anzeigen: <code>GET /api/shiftexchanges/available</code></li>
                            <li>Gew√ºnschten Dienst anfragen: <code>POST /api/shiftexchanges/{id}/request</code></li>
                            <li>Status wechselt zu "Angefragt"</li>
                        </ol>

                        <h4>Tausch genehmigen (Disponent/Admin)</h4>
                        <ol>
                            <li>Offene Tauschanfragen anzeigen: <code>GET /api/shiftexchanges/pending</code></li>
                            <li>Tausch pr√ºfen und genehmigen/ablehnen: <code>PUT /api/shiftexchanges/{id}/process</code></li>
                            <li>Bei Genehmigung wird die Schicht automatisch umgeschichtet</li>
                        </ol>

                        <p><strong>Wichtig:</strong> Auch bei genehmigten Tauschen werden die Ruhezeiten und Planungsregeln gepr√ºft!</p>
                    </section>

                    <section id="manual-statistics" class="manual-section">
                        <h3>7. Statistiken</h3>
                        
                        <div class="manual-screenshot">
                            <img src="images/screenshots/09-statistics.png" alt="Statistiken" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-style: italic; margin-top: 10px;">Abbildung: Statistiken und Auswertungen</p>
                        </div>
                        
                        <p>Die Statistik-Ansicht bietet Ihnen einen √úberblick √ºber:</p>
                        <ul>
                            <li><strong>Arbeitsstunden:</strong> Gesamtstunden und Schichtanzahl pro Mitarbeiter</li>
                            <li><strong>Schichtverteilung:</strong> Verteilung der Schichtarten pro Team</li>
                            <li><strong>Fehltage:</strong> √úbersicht der Abwesenheiten nach Typ</li>
                            <li><strong>Team-Auslastung:</strong> Durchschnittliche Schichten pro Mitarbeiter</li>
                            <li><strong>Wochenend-Statistiken (Admin/Disponent):</strong> Samstags- und Sonntagsdienste je Mitarbeiter</li>
                        </ul>
                        <p>W√§hlen Sie den gew√ºnschten Zeitraum aus und klicken Sie auf "Aktualisieren".</p>
                        
                        <h4>Wochenend-Statistiken abrufen</h4>
                        <p>Als Administrator oder Disponent k√∂nnen Sie detaillierte Wochenend-Statistiken abrufen:</p>
                        <code>GET /api/statistics/weekend-shifts?startDate=2025-01-01&endDate=2025-12-31</code>
                    </section>

                    <section id="manual-email" class="manual-section">
                        <h3>8. E-Mail-Einstellungen</h3>
                        <p>Als Administrator k√∂nnen Sie die E-Mail-Server-Einstellungen konfigurieren, um automatische Benachrichtigungen zu erm√∂glichen.</p>
                        
                        <h4>E-Mail-Konfiguration anlegen</h4>
                        <ol>
                            <li>Verwenden Sie die API: <code>POST /api/emailsettings</code></li>
                            <li>Erforderliche Einstellungen:
                                <ul>
                                    <li><strong>SMTP Server:</strong> Hostname oder IP-Adresse (z.B. smtp.gmail.com)</li>
                                    <li><strong>Port:</strong> Standard 587 f√ºr STARTTLS, 465 f√ºr SSL, 25 f√ºr unverschl√ºsselt</li>
                                    <li><strong>Protokoll:</strong> SMTP oder SMTPS</li>
                                    <li><strong>Sicherheit:</strong> None, SSL, TLS oder STARTTLS</li>
                                    <li><strong>Authentifizierung:</strong> Ja/Nein</li>
                                    <li><strong>Benutzername:</strong> Falls Authentifizierung erforderlich</li>
                                    <li><strong>Passwort:</strong> Falls Authentifizierung erforderlich</li>
                                    <li><strong>Absenderadresse:</strong> z.B. dienstplan@fritzwinter.de</li>
                                    <li><strong>Absendername:</strong> z.B. "Dienstplan-System"</li>
                                    <li><strong>Antwortadresse:</strong> Optional, falls abweichend</li>
                                </ul>
                            </li>
                        </ol>

                        <h4>Mitarbeiter-E-Mails pflegen</h4>
                        <p>Erfassen Sie E-Mail-Adressen f√ºr jeden Mitarbeiter, der Benachrichtigungen erhalten soll:</p>
                        <ol>
                            <li>√ñffnen Sie den Mitarbeiter zur Bearbeitung</li>
                            <li>Tragen Sie die E-Mail-Adresse im Feld "E-Mail" ein</li>
                            <li>Speichern Sie die √Ñnderungen</li>
                        </ol>

                        <h4>Aktive Konfiguration abrufen</h4>
                        <code>GET /api/emailsettings/active</code>

                        <p><strong>Sicherheitshinweis:</strong> Das System zeigt Passw√∂rter niemals in API-Antworten an. Passw√∂rter sollten vor der Speicherung verschl√ºsselt werden.</p>
                    </section>

                    <section id="manual-rules" class="manual-section">
                        <h3>9. Schichtplanungsregeln</h3>
                        <p>Das System beachtet automatisch folgende Regeln:</p>
                        
                        <h4>Schichtarten</h4>
                        <table class="rules-table">
                            <tr>
                                <th>Schicht</th>
                                <th>Code</th>
                                <th>Uhrzeit</th>
                            </tr>
                            <tr>
                                <td>Fr√ºhdienst</td>
                                <td class="shift-badge shift-F">F</td>
                                <td>05:45 ‚Äì 13:45</td>
                            </tr>
                            <tr>
                                <td>Sp√§tdienst</td>
                                <td class="shift-badge shift-S">S</td>
                                <td>13:45 ‚Äì 21:45</td>
                            </tr>
                            <tr>
                                <td>Nachtdienst</td>
                                <td class="shift-badge shift-N">N</td>
                                <td>21:45 ‚Äì 05:45</td>
                            </tr>
                            <tr>
                                <td>Zwischendienst</td>
                                <td class="shift-badge shift-ZD">ZD</td>
                                <td>08:00 ‚Äì 16:00</td>
                            </tr>
                        </table>

                        <h4>Besetzungsregeln</h4>
                        <p><strong>Montag bis Freitag:</strong></p>
                        <ul>
                            <li>Fr√ºhdienst: 4-5 Personen</li>
                            <li>Sp√§tdienst: 3-4 Personen</li>
                            <li>Nachtdienst: 3 Personen</li>
                        </ul>
                        <p><strong>Samstag und Sonntag:</strong></p>
                        <ul>
                            <li>Alle Schichten: maximal 3 Personen</li>
                        </ul>

                        <h4>Verbotene Schichtwechsel</h4>
                        <ul>
                            <li>‚ùå Sp√§tdienst ‚Üí Fr√ºhdienst (zu kurze Ruhezeit)</li>
                            <li>‚ùå Nachtdienst ‚Üí Sp√§tdienst (zu kurze Ruhezeit)</li>
                            <li>‚ùå Gleiche Schicht zweimal hintereinander</li>
                        </ul>

                        <h4>Idealer Rhythmus</h4>
                        <p>Fr√ºhdienst ‚Üí Nachtdienst ‚Üí Sp√§tdienst</p>
                        <p>Dieser Rhythmus erm√∂glicht optimale Ruhezeiten und Belastungsverteilung.</p>

                        <h4>Ruhezeiten</h4>
                        <p>Mindestens 11 Stunden Ruhezeit zwischen zwei Schichten (gesetzlich vorgeschrieben).</p>
                    </section>

                    <section id="manual-springer" class="manual-section">
                        <h3>10. Springer-System</h3>
                        <p>Das Springer-System sorgt f√ºr automatische Vertretung bei kurzfristigen Ausf√§llen.</p>
                        
                        <h4>Springer definieren</h4>
                        <p>Markieren Sie beim Anlegen oder Bearbeiten eines Mitarbeiters das Feld "Springer".</p>
                        
                        <h4>Automatische Zuweisung</h4>
                        <p>Bei Erfassung einer Abwesenheit pr√ºft das System automatisch:</p>
                        <ol>
                            <li>Welche Schichten betroffen sind</li>
                            <li>Welche Springer verf√ºgbar sind</li>
                            <li>Weist den ersten verf√ºgbaren Springer zu</li>
                        </ol>
                        <p class="note"><strong>Hinweis:</strong> Springer werden nur bei tats√§chlichen Ausf√§llen eingesetzt, nicht bei der regul√§ren Planung.</p>
                    </section>

                    <section id="manual-troubleshooting" class="manual-section">
                        <h3>11. Problembehebung</h3>
                        
                        <h4>Problem: Schichtplanung schl√§gt fehl</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Pr√ºfen Sie, ob gen√ºgend Mitarbeiter verf√ºgbar sind</li>
                            <li>√úberpr√ºfen Sie bestehende Abwesenheiten</li>
                            <li>Stellen Sie sicher, dass mindestens 12-15 Mitarbeiter angelegt sind</li>
                        </ul>

                        <h4>Problem: Kein Springer verf√ºgbar</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Definieren Sie weitere Mitarbeiter als Springer</li>
                            <li>Pr√ºfen Sie Abwesenheiten der Springer</li>
                            <li>Bei Bedarf: Manuelle Zuweisung einer Vertretung</li>
                        </ul>

                        <h4>Problem: Statistiken werden nicht angezeigt</h4>
                        <p><strong>L√∂sung:</strong></p>
                        <ul>
                            <li>Pr√ºfen Sie den ausgew√§hlten Zeitraum</li>
                            <li>Stellen Sie sicher, dass Schichten f√ºr diesen Zeitraum vorhanden sind</li>
                            <li>Aktualisieren Sie die Seite (F5)</li>
                        </ul>

                        <h4>Weitere Hilfe</h4>
                        <p>Bei weiteren Fragen wenden Sie sich bitte an:</p>
                        <ul>
                            <li>IT-Support: support@fritzwinter.de</li>
                            <li>Telefon: +49 XXX XXXXXXX</li>
                        </ul>
                    </section>

                    <div class="manual-footer">
                        <p><strong>Version:</strong> 1.2</p>
                        <p><strong>Entwickelt von:</strong> Timo Braun</p>
                        <p><strong>Letzte Aktualisierung:</strong> Dezember 2025</p>
                        <p>¬© Fritz Winter Eisengie√üerei GmbH & Co. KG</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for adding/editing employee -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmployeeModal()">&times;</span>
            <h2 id="employeeModalTitle">Mitarbeiter hinzuf√ºgen</h2>
            <form id="employeeForm" onsubmit="saveEmployee(event)">
                <input type="hidden" id="employeeId">
                <div class="form-group">
                    <label>Vorname*</label>
                    <input type="text" id="vorname" required>
                </div>
                <div class="form-group">
                    <label>Name*</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label>Personalnummer*</label>
                    <input type="text" id="personalnummer" required>
                </div>
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="email" placeholder="mitarbeiter@fritzwinter.de">
                </div>
                <div class="form-group">
                    <label>Geburtsdatum</label>
                    <input type="date" id="geburtsdatum">
                </div>
                <div class="form-group">
                    <label>Team</label>
                    <select id="teamId">
                        <option value="">Kein Team</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isSpringer">
                        Springer (Vertretungspool)
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isTeamLeader">
                        Team-Leiter
                    </label>
                </div>
                <div class="form-group">
                    <label>Sonderfunktionen</label>
                    <div style="margin-top: 8px;">
                        <label style="display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="isBrandmeldetechniker" style="margin-right: 8px;">
                            Brandmeldetechniker (BMT)
                        </label>
                        <label style="display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="isBrandschutzbeauftragter" style="margin-right: 8px;">
                            Brandschutzbeauftragter (BSB)
                        </label>
                    </div>
                    <small class="field-note">Mitarbeiter mit BMT oder BSB sind automatisch TD-Qualifiziert</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isFerienjobber">
                        Ferienjobber (Tempor√§rer Mitarbeiter)
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeEmployeeModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2>Anmelden</h2>
            <form id="loginForm" onsubmit="login(event)">
                <div class="form-group">
                    <label>E-Mail*</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Passwort*</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="rememberMe">
                        Angemeldet bleiben
                    </label>
                </div>
                <div id="loginError" class="error-message" style="display: none;"></div>
                <div class="form-actions">
                    <button type="button" onclick="closeLoginModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Anmelden</button>
                </div>
            </form>
            <div class="login-info">
                <p><strong>Standard-Anmeldedaten:</strong></p>
                <p>E-Mail: admin@fritzwinter.de</p>
                <p>Passwort: Admin123!</p>
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTeamModal()">&times;</span>
            <h2 id="teamModalTitle">Team hinzuf√ºgen</h2>
            <form id="teamForm" onsubmit="saveTeam(event)">
                <input type="hidden" id="teamId">
                <div class="form-group">
                    <label>Team-Name*</label>
                    <input type="text" id="teamName" required placeholder="z.B. Team A">
                </div>
                <div class="form-group">
                    <label>Beschreibung</label>
                    <textarea id="teamDescription" rows="3" placeholder="Beschreibung des Teams"></textarea>
                </div>
                <div class="form-group">
                    <label>E-Mail</label>
                    <input type="email" id="teamEmail" placeholder="team@fritzwinter.de">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="teamIsVirtual">
                        Virtuelles Team (Mitarbeiter erscheinen nicht in der regul√§ren Schichtplanung)
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeTeamModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Vacation Period Modal -->
    <div id="vacationPeriodModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVacationPeriodModal()">&times;</span>
            <h2 id="vacationPeriodModalTitle">Ferienzeit hinzuf√ºgen</h2>
            <form id="vacationPeriodForm" onsubmit="saveVacationPeriod(event)">
                <input type="hidden" id="vacationPeriodId">
                <div class="form-group">
                    <label>Name*</label>
                    <input type="text" id="vacationPeriodName" required placeholder="z.B. Sommerferien, Weihnachtsferien, Osterferien">
                </div>
                <div class="form-group">
                    <label>Von (Startdatum)*</label>
                    <input type="date" id="vacationPeriodStartDate" required>
                </div>
                <div class="form-group">
                    <label>Bis (Enddatum)*</label>
                    <input type="date" id="vacationPeriodEndDate" required>
                </div>
                <div class="form-group">
                    <label>Farbe</label>
                    <input type="color" id="vacationPeriodColor" value="#E8F5E9">
                    <small>Farbe f√ºr die Darstellung in den Kalenderansichten</small>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeVacationPeriodModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shift Type Modal -->
    <div id="shiftTypeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShiftTypeModal()">&times;</span>
            <h2 id="shiftTypeModalTitle">Schichttyp hinzuf√ºgen</h2>
            <form id="shiftTypeForm" onsubmit="saveShiftType(event)">
                <input type="hidden" id="shiftTypeId">
                <div class="form-group">
                    <label>Schichtk√ºrzel*</label>
                    <input type="text" id="shiftTypeCode" required placeholder="z.B. F, S, N, TD" maxlength="10">
                    <small>Eindeutiges K√ºrzel f√ºr die Schicht</small>
                </div>
                <div class="form-group">
                    <label>Schichtname*</label>
                    <input type="text" id="shiftTypeName" required placeholder="z.B. Fr√ºhdienst, Sp√§tdienst, Nachtdienst">
                </div>
                <div class="form-group">
                    <label>Startzeit*</label>
                    <input type="time" id="shiftTypeStartTime" required>
                </div>
                <div class="form-group">
                    <label>Endzeit*</label>
                    <input type="time" id="shiftTypeEndTime" required>
                </div>
                <div class="form-group">
                    <label>Arbeitsstunden*</label>
                    <input type="number" id="shiftTypeDuration" required step="0.5" min="0" max="24" placeholder="z.B. 8.0">
                    <small>Dauer der Schicht in Stunden</small>
                </div>
                <div class="form-group">
                    <label>Farbe*</label>
                    <input type="color" id="shiftTypeColor" value="#808080" required>
                    <small>Farbe f√ºr die Darstellung im Schichtplan</small>
                </div>
                <div class="form-group">
                    <label>Arbeitstage*</label>
                    <small>An welchen Wochentagen wird diese Schicht gearbeitet?</small>
                    <div class="workdays-checkboxes">
                        <label><input type="checkbox" id="shiftTypeMonday" checked> Montag</label>
                        <label><input type="checkbox" id="shiftTypeTuesday" checked> Dienstag</label>
                        <label><input type="checkbox" id="shiftTypeWednesday" checked> Mittwoch</label>
                        <label><input type="checkbox" id="shiftTypeThursday" checked> Donnerstag</label>
                        <label><input type="checkbox" id="shiftTypeFriday" checked> Freitag</label>
                        <label><input type="checkbox" id="shiftTypeSaturday"> Samstag</label>
                        <label><input type="checkbox" id="shiftTypeSunday"> Sonntag</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Wochen-Arbeitszeit*</label>
                    <input type="number" id="shiftTypeWeeklyHours" required step="0.5" min="0" max="168" value="40.0" placeholder="z.B. 40.0">
                    <small>W√∂chentliche Arbeitszeit in Stunden, die Mitarbeiter leisten m√ºssen</small>
                </div>
                
                <div class="form-group">
                    <label>Personalst√§rke Wochentage (Mo-Fr)*</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-weight: normal; font-size: 0.9em;">Minimum*</label>
                            <input type="number" id="shiftTypeMinStaffWeekday" required min="1" max="50" value="3" placeholder="z.B. 3">
                        </div>
                        <div>
                            <label style="font-weight: normal; font-size: 0.9em;">Maximum*</label>
                            <input type="number" id="shiftTypeMaxStaffWeekday" required min="1" max="50" value="5" placeholder="z.B. 5">
                        </div>
                    </div>
                    <small>Mindest- und Maximalanzahl Mitarbeiter in dieser Schicht an Wochentagen</small>
                </div>
                
                <div class="form-group">
                    <label>Personalst√§rke Wochenende (Sa-So)*</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-weight: normal; font-size: 0.9em;">Minimum*</label>
                            <input type="number" id="shiftTypeMinStaffWeekend" required min="1" max="50" value="2" placeholder="z.B. 2">
                        </div>
                        <div>
                            <label style="font-weight: normal; font-size: 0.9em;">Maximum*</label>
                            <input type="number" id="shiftTypeMaxStaffWeekend" required min="1" max="50" value="3" placeholder="z.B. 3">
                        </div>
                    </div>
                    <small>Mindest- und Maximalanzahl Mitarbeiter in dieser Schicht am Wochenende</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="shiftTypeIsActive" checked>
                        Aktiv (Schicht kann verwendet werden)
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeShiftTypeModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shift Type Teams Modal -->
    <div id="shiftTypeTeamsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShiftTypeTeamsModal()">&times;</span>
            <h2 id="shiftTypeTeamsModalTitle">Teams f√ºr Schicht zuweisen</h2>
            <form id="shiftTypeTeamsForm" onsubmit="saveShiftTypeTeams(event)">
                <input type="hidden" id="shiftTypeTeamsId">
                <div class="form-group">
                    <label>W√§hlen Sie die Teams aus, die diese Schicht arbeiten k√∂nnen:</label>
                    <div id="shiftTypeTeamsList" class="checkbox-list">
                        <p class="loading">Lade Teams...</p>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeShiftTypeTeamsModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shift Type Relationships Modal -->
    <div id="shiftTypeRelationshipsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShiftTypeRelationshipsModal()">&times;</span>
            <h2 id="shiftTypeRelationshipsModalTitle">Schichtreihenfolge festlegen</h2>
            <form id="shiftTypeRelationshipsForm" onsubmit="saveShiftTypeRelationships(event)">
                <input type="hidden" id="shiftTypeRelationshipsId">
                <div class="form-group">
                    <label>Definieren Sie die Reihenfolge der nachfolgenden Schichten:</label>
                    <small>Ziehen Sie die Schichten in die gew√ºnschte Reihenfolge.</small>
                    <div id="shiftTypeRelationshipsList" class="sortable-list">
                        <p class="loading">Lade Schichten...</p>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeShiftTypeRelationshipsModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Vacation Request Modal -->
    <div id="vacationRequestModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVacationRequestModal()">&times;</span>
            <h2>Urlaubsantrag stellen</h2>
            <form id="vacationRequestForm" onsubmit="saveVacationRequest(event)">
                <div class="form-group">
                    <label>Mitarbeiter*</label>
                    <select id="vacationEmployeeId" required>
                        <option value="">Mitarbeiter w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Von (Startdatum)*</label>
                    <input type="date" id="vacationStartDate" required>
                </div>
                <div class="form-group">
                    <label>Bis (Enddatum)*</label>
                    <input type="date" id="vacationEndDate" required>
                </div>
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="vacationNotes" rows="3" placeholder="Optional: Grund oder Hinweise zum Urlaubsantrag"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeVacationRequestModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Antrag einreichen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Absence (AU/L) Modal -->
    <div id="absenceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAbsenceModal()">&times;</span>
            <h2 id="absenceModalTitle">Abwesenheit erfassen</h2>
            <form id="absenceForm" onsubmit="saveAbsence(event)">
                <input type="hidden" id="absenceType">
                <div class="form-group">
                    <label>Mitarbeiter*</label>
                    <select id="absenceEmployeeId" required>
                        <option value="">Mitarbeiter w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Von (Startdatum)*</label>
                    <input type="date" id="absenceStartDate" required>
                </div>
                <div class="form-group">
                    <label>Bis (Enddatum)*</label>
                    <input type="date" id="absenceEndDate" required>
                </div>
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="absenceNotes" rows="3" placeholder="Optional: Zus√§tzliche Informationen"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeAbsenceModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shift Exchange Modal -->
    <div id="shiftExchangeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShiftExchangeModal()">&times;</span>
            <h2>Dienst zum Tausch anbieten</h2>
            <form id="shiftExchangeForm" onsubmit="saveShiftExchange(event)">
                <div class="form-group">
                    <label>Datum*</label>
                    <input type="date" id="exchangeDate" required>
                </div>
                <div class="form-group">
                    <label>Mitarbeiter*</label>
                    <select id="exchangeEmployeeId" required>
                        <option value="">Mitarbeiter w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Schicht*</label>
                    <select id="exchangeShiftId" required>
                        <option value="">Zuerst Datum und Mitarbeiter w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Grund f√ºr den Tausch</label>
                    <textarea id="exchangeReason" rows="3" placeholder="Optional: Grund f√ºr den Tauschwunsch"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeShiftExchangeModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Tausch anbieten</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Shift Assignment Modal -->
    <div id="editShiftModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditShiftModal()">&times;</span>
            <h2 id="editShiftModalTitle">Schicht bearbeiten</h2>
            <form id="editShiftForm" onsubmit="saveShiftAssignment(event)">
                <input type="hidden" id="editShiftId">
                <div class="form-group">
                    <label>Mitarbeiter*</label>
                    <select id="editShiftEmployeeId" required>
                        <option value="">Mitarbeiter w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Datum*</label>
                    <input type="date" id="editShiftDate" required>
                </div>
                <div class="form-group">
                    <label>Schichttyp*</label>
                    <select id="editShiftTypeId" required>
                        <option value="">Schichttyp w√§hlen...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editShiftIsFixed">
                        Feste Schicht (wird nicht automatisch ge√§ndert)
                    </label>
                </div>
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="editShiftNotes" rows="3" placeholder="Optional: Notizen zur Schichtzuweisung"></textarea>
                </div>
                <div id="editShiftWarning" class="warning-box" style="display: none;">
                    <p><strong>‚ö†Ô∏è Regelversto√ü:</strong></p>
                    <p id="editShiftWarningText"></p>
                    <p>M√∂chten Sie die √Ñnderung trotzdem vornehmen?</p>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeEditShiftModal()" class="btn-secondary">Abbrechen</button>
                    <button type="button" onclick="deleteShiftAssignment()" class="btn-danger admin-only">L√∂schen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div id="bulkEditModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBulkEditModal()">&times;</span>
            <h2>Mehrere Schichten bearbeiten</h2>
            <p>Sie bearbeiten <strong id="bulkEditShiftCount">0</strong> Schichten gleichzeitig.</p>
            
            <div id="bulkEditSummary"></div>
            
            <form id="bulkEditForm" onsubmit="saveBulkEdit(event)">
                <div class="form-group">
                    <label>Mitarbeiter √§ndern</label>
                    <select id="bulkEditEmployeeId">
                        <option value="">Keine √Ñnderung</option>
                    </select>
                    <small>Leer lassen, um den Mitarbeiter nicht zu √§ndern</small>
                </div>
                <div class="form-group">
                    <label>Schichttyp √§ndern</label>
                    <select id="bulkEditShiftTypeId">
                        <option value="">Keine √Ñnderung</option>
                    </select>
                    <small>Leer lassen, um den Schichttyp nicht zu √§ndern</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="bulkEditIsFixed">
                        Alle als feste Schichten markieren (werden nicht automatisch ge√§ndert)
                    </label>
                </div>
                <div class="form-group">
                    <label>Notizen hinzuf√ºgen</label>
                    <textarea id="bulkEditNotes" rows="3" placeholder="Optional: Notizen zu allen ausgew√§hlten Schichten hinzuf√ºgen"></textarea>
                </div>
                <div id="bulkEditWarning" class="warning-box" style="display: none;">
                    <p><strong>‚ö†Ô∏è Warnung:</strong></p>
                    <p id="bulkEditWarningText"></p>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeBulkEditModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Alle ausgew√§hlten Schichten aktualisieren</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h2 id="userModalTitle">Benutzer hinzuf√ºgen</h2>
            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Vollst√§ndiger Name*</label>
                    <input type="text" id="userFullName" required placeholder="Max Mustermann">
                </div>
                <div class="form-group">
                    <label>E-Mail*</label>
                    <input type="email" id="userEmail" required placeholder="benutzer@fritzwinter.de">
                </div>
                <div class="form-group" id="passwordGroup">
                    <label>Passwort*</label>
                    <input type="password" id="userPassword" placeholder="Mindestens 8 Zeichen">
                    <small>Muss mindestens 8 Zeichen, einen Gro√übuchstaben, einen Kleinbuchstaben und eine Ziffer enthalten.</small>
                </div>
                <div class="form-group">
                    <label>Rolle*</label>
                    <select id="userRole" required>
                        <option value="Mitarbeiter">Mitarbeiter (Lesezugriff)</option>
                        <option value="Disponent">Disponent (Planung & Bearbeitung)</option>
                        <option value="Admin">Administrator (Volle Berechtigung)</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeUserModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Email Settings Modal -->
    <div id="emailSettingsModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeEmailSettingsModal()">&times;</span>
            <h2>E-Mail-Einstellungen</h2>
            <form id="emailSettingsForm" onsubmit="saveEmailSettings(event)">
                <h3>SMTP-Server</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>SMTP Server*</label>
                        <input type="text" id="smtpServer" required placeholder="smtp.gmail.com">
                    </div>
                    <div class="form-group">
                        <label>Port*</label>
                        <input type="number" id="smtpPort" required value="587" min="1" max="65535">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Protokoll*</label>
                        <select id="smtpProtocol" required>
                            <option value="SMTP">SMTP</option>
                            <option value="SMTPS">SMTPS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Sicherheit*</label>
                        <select id="smtpSecurity" required>
                            <option value="None">Keine</option>
                            <option value="SSL">SSL</option>
                            <option value="TLS">TLS</option>
                            <option value="STARTTLS" selected>STARTTLS</option>
                        </select>
                    </div>
                </div>
                
                <h3>Authentifizierung</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="requiresAuth" checked>
                        Authentifizierung erforderlich
                    </label>
                </div>
                <div id="authFields">
                    <div class="form-group">
                        <label>Benutzername</label>
                        <input type="text" id="smtpUsername" placeholder="benutzer@domain.de">
                    </div>
                    <div class="form-group">
                        <label>Passwort</label>
                        <input type="password" id="smtpPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <small>Leer lassen, um bestehendes Passwort nicht zu √§ndern</small>
                    </div>
                </div>

                <h3>Absender-Informationen</h3>
                <div class="form-group">
                    <label>Absenderadresse*</label>
                    <input type="email" id="senderEmail" required placeholder="dienstplan@fritzwinter.de">
                </div>
                <div class="form-group">
                    <label>Absendername*</label>
                    <input type="text" id="senderName" required value="Dienstplan-System">
                </div>
                <div class="form-group">
                    <label>Antwortadresse</label>
                    <input type="email" id="replyToEmail" placeholder="Optional, falls abweichend">
                </div>

                <div class="form-actions">
                    <button type="button" onclick="closeEmailSettingsModal()" class="btn-secondary">Abbrechen</button>
                    <button type="button" onclick="testEmailSettings()" class="btn-secondary">Test-E-Mail senden</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plan Shifts Modal -->
    <div id="planShiftsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePlanShiftsModal()">&times;</span>
            <h2>Schichten automatisch planen</h2>
            <form id="planShiftsForm" onsubmit="executePlanShifts(event)">
                <div class="form-group">
                    <label>Planungszeitraum*</label>
                    <select id="planPeriodType" onchange="updatePlanPeriodFields()" required>
                        <option value="">Bitte w√§hlen...</option>
                        <option value="month">Monat</option>
                        <option value="year">Jahr</option>
                    </select>
                </div>
                
                <!-- Month Planning Fields -->
                <div id="monthPlanFields" style="display: none;">
                    <div class="form-group">
                        <label>Monat*</label>
                        <select id="planMonth">
                            <option value="1">Januar</option>
                            <option value="2">Februar</option>
                            <option value="3">M√§rz</option>
                            <option value="4">April</option>
                            <option value="5">Mai</option>
                            <option value="6">Juni</option>
                            <option value="7">Juli</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12">Dezember</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Jahr*</label>
                        <select id="planMonthYear"></select>
                    </div>
                </div>
                
                <!-- Year Planning Fields -->
                <div id="yearPlanFields" style="display: none;">
                    <div class="form-group">
                        <label>Jahr*</label>
                        <select id="planYear"></select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="planForceOverwrite">
                        Bestehende Schichten √ºberschreiben (au√üer feste Schichten)
                    </label>
                </div>
                
                <div class="info-box">
                    <p><strong>‚ÑπÔ∏è Hinweis:</strong></p>
                    <p>Das System plant automatisch Schichten f√ºr alle Teams unter Ber√ºcksichtigung aller Regeln und bestehender Abwesenheiten.</p>
                    <p>Feste Schichten werden niemals √ºberschrieben.</p>
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="closePlanShiftsModal()" class="btn-secondary">Abbrechen</button>
                    <button type="submit" class="btn-primary">Schichten planen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeNotificationModal()">&times;</span>
            <h2>üîî Benachrichtigungen √ºber Mindestschichtst√§rke</h2>
            
            <div class="notification-header">
                <button onclick="filterNotifications('all')" class="btn-secondary" id="filter-all">Alle</button>
                <button onclick="filterNotifications('unread')" class="btn-secondary active" id="filter-unread">Ungelesen</button>
                <button onclick="markAllNotificationsRead()" class="btn-secondary">Alle als gelesen markieren</button>
            </div>
            
            <div id="notification-list" class="notification-list">
                <p class="loading">Lade Benachrichtigungen...</p>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <p><strong>Dienstplan-System v1.2</strong></p>
                <p>¬© 2025 Fritz Winter Eisengie√üerei GmbH & Co. KG</p>
            </div>
            <div class="footer-right">
                <p>Entwickelt von <strong>Timo Braun</strong></p>
                <p>Letzte Aktualisierung: Dezember 2025</p>
            </div>
        </div>
    </footer>

    <script src="/js/app.js"></script>
</body>
</html>
